<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.13.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Failed Attempt to Chinese Speech Recognition Service - Blog</title>
<meta name="description" content="It’s obvious that many application supports speech recognition for sentences. Actually, everywhere.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Blog">
<meta property="og:title" content="Failed Attempt to Chinese Speech Recognition Service">
<meta property="og:url" content="https://erickguan.me/2014/failed-attempt-to-chinese-speech-recognition-service">


  <meta property="og:description" content="It’s obvious that many application supports speech recognition for sentences. Actually, everywhere.">





  <meta name="twitter:site" content="@erickguan">
  <meta name="twitter:title" content="Failed Attempt to Chinese Speech Recognition Service">
  <meta name="twitter:description" content="It’s obvious that many application supports speech recognition for sentences. Actually, everywhere.">
  <meta name="twitter:url" content="https://erickguan.me/2014/failed-attempt-to-chinese-speech-recognition-service">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2014-05-25T00:00:00+02:00">





  

  


<link rel="canonical" href="https://erickguan.me/2014/failed-attempt-to-chinese-speech-recognition-service">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Erick Guan",
      "url": "https://erickguan.me",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#da532c">
<meta name="apple-mobile-web-app-title" content="Erick Guan">
<meta name="application-name" content="Erick Guan">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Blog</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about" >About</a>
            </li><li class="masthead__menu-item">
              <a href="https://lifelimited.company" >中文</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Failed Attempt to Chinese Speech Recognition Service">
    <meta itemprop="description" content="It’s obvious that many application supports speech recognition for sentences. Actually, everywhere.">
    <meta itemprop="datePublished" content="May 25, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Failed Attempt to Chinese Speech Recognition Service
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>It’s obvious that many application supports speech recognition for sentences. Actually, everywhere.</p>

<p>But here I want is to convert a Chinese podcast, <a href="http://teahour.fm/">Teahour.fm</a>, to text for read. It’s about 80 minutes per podcast. There is no silver bullet here. Even the text can be automated converted, it’s still need to be make it readable for human, editor work.</p>

<h2 id="speech-recognition-service-for-chinese">Speech Recognition Service for Chinese</h2>

<p>I got 3 choices.</p>

<ol>
  <li><a href="https://github.com/gillesdemey/google-speech-v2">Unpublished Google Speech API</a>, it’s used for Android and Google services.</li>
  <li><a href="http://open.voicecloud.cn/index.php/default/index">Xunfei</a>. Local company, leading Chinese speech recognition. It provides many SDK. But the document is shit and no support for OS X.</li>
  <li><a href="http://cmusphinx.sourceforge.net/">CMU Sphinx4</a>. I can find some article about PocketSphinx. Not enough to me to understand the how it works and its API. I beg for documents and examples. I tried it, but ended it with its IndexOutOfBoundsException. Come on, you can’t be serious…</li>
</ol>

<p>Actually, I found more service for speech recognition service. But it’s used for sentence. And for mobile app…</p>

<h2 id="final-choice">Final choice</h2>

<p>I came back to Google Speech API. The limitation is you can’t POST big audio file, nor long audio. So I wrote the Ruby script to slice the podcast into 5 seconds piece. And the results is not good.
I can’t</p>

<ol>
  <li>slice the audio at the correct point, e.g. one sentence for one request. <em>Exploring Everyday Things with R and Ruby</em> may include some interesting way to slice the audio.</li>
  <li>and Google Speech API is not good enough to know Chinese. You just got meaningless word combinations.</li>
</ol>

<h2 id="script">Script</h2>

<p>Anyway, here is the script. FFmpeg is to slice the audio to 5 seconds pieces. A offset was added to randomly choose the point.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require 'curb'
require 'multi_json'

# Config
file_name = 'teahour.m4a'
start_time = 0
end_time = 4990
duration = 5
offset = 3
output_name = 'output.flac'
result_name = 'result.txt'

# result file
result_file = File.new(result_name, 'w')

# Curl
google_speech_api_url = 'https://www.google.com/speech-api/v2/recognize?output=json&amp;amp;lang=zh-cn&amp;amp;key=AIzaSyCnl6MRydhw_5fLXIdASxkLJzcJh5iX0M4'
curl = Curl::Easy.new(google_speech_api_url)
curl.headers['Content-Type'] = 'audio/x-flac; rate=32000'

(start_time..end_time).step(duration) do |n|
  (0..offset).step(1) do |o|
    # ffmpeg
    command = 'ffmpeg -y -i ' + file_name + ' -f flac -ss ' + (n + o).to_s +
          ' -t ' + duration.to_s + ' ' + output_name
    system command

    # preapre for request
    data = File.read(output_name)
    curl.post_body = data
    begin
      curl.http_post
    rescue
      next
    end

    # parse the result, assumption exist
    json = MultiJson.load(curl.body, symbolize_keys: true)
    result = begin
      json[:result][0][:alternative][0][:transcript]
    rescue
      ''
    end
    result_file.puts(result)
  end
end

result_file.close
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-05-25T00:00:00+02:00">May 25, 2014</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=erickguan&text=Failed+Attempt+to+Chinese+Speech+Recognition+Service%20https%3A%2F%2Ferickguan.me%2F2014%2Ffailed-attempt-to-chinese-speech-recognition-service" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ferickguan.me%2F2014%2Ffailed-attempt-to-chinese-speech-recognition-service" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Ferickguan.me%2F2014%2Ffailed-attempt-to-chinese-speech-recognition-service" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Ferickguan.me%2F2014%2Ffailed-attempt-to-chinese-speech-recognition-service" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2014/mechanize-encoding-problem-with-gbk" class="pagination--pager" title="Mechanize encoding problem with GBK
">Previous</a>
    
    
      <a href="/2014/add-a-system-call-to-linux-3-14" class="pagination--pager" title="Adding a system call to Linux 3.14
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a Comment</h4>
      <section id="disqus_thread"></section>
    
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018/erik-eastman-256489-unsplash-200.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/python-iterator" rel="permalink">Digging in Python iterator and enumerate
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">When a PyTorch DataLoader repeat its data? Why it’s so magical and impossible to see in its code. It is implemented as an iterator in Python. Pythonic but im...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/teaser.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2017/k-nearest-neighbour-in-scikit-learn" rel="permalink">K-Nearest Neighbor Classification in Scikit Learn
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">K-Nearest Neighbor (k-NN) presents a a simple straightforward instance-based
learning. Often, a simple strategy produces a good result as well as acting as
b...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/teaser.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2017/the-surprise-number-in-javascript" rel="permalink">The Surprising Number in JavaScript
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Did you know you can not have a number larger than  in JavaScript?

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/teaser.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2017/copy-and-paste-bookmarklet" rel="permalink">Copy and Paste Bookmarklet
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Inspired by DontFuckWithPaste.

</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Erick Guan. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36993160-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36993160-8', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://erickguan.me/2014/failed-attempt-to-chinese-speech-recognition-service";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2014/failed-attempt-to-chinese-speech-recognition-service"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://fftenacity.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>